# 电老虎测试 - 电动车性能调教助手

一款专为电动车爱好者打造的性能测试和数据分析工具，帮助你找到最佳的电流设置，实现续航和动力的完美平衡。

## 📱 功能特性

### 🎯 核心功能

#### 1. 智能数据录入
- **快速模板系统**：保存常用的母线/相线电流配置，一键应用
- **自动填充**：记住上次输入的电流值，减少重复输入
- **实时预览**：输入数据时即时计算能耗、续航和电费
- **多维度记录**：支持记录温度、路况标签、备注等详细信息

#### 2. 充电管理系统 ⭐ NEW
- **充电效率设置** ⭐：
  - 可配置充电效率（默认88%，代表12%损耗）
  - 自动区分实际入电量和充电度数
  - 充电费用基于充电度数计算，更准确反映实际成本
- **充电记录录入**：
  - 记录充电前后 SOC（电量百分比，支持从0%开始）
  - 自动计算充电量、实际入电量、充电度数（kWh）、充电费用
  - 预设充电地点（家里、快充站、公司、商场）
  - 支持自定义地点和备注
  - 实时预览充电数据（2×2网格布局显示4项数据）
  - 底部提示充电效率损耗百分比
- **充电记录管理**：
  - 充电记录列表，视觉化显示 SOC 变化（绿色前→粉色后）
  - 右上角充电徽章显示充电量（小巧精致）
  - 显示充电量、实际入电量、充电度数、充电费用
  - 滑动删除、点击编辑
- **充电统计**：
  - 本月/本周充电统计（次数、总度数、总费用）
  - 所有统计均计入充电效率损耗
  - 渐变卡片设计（金黄到粉橙）

#### 3. 年度/月度综合统计 ⭐ NEW
- **年度统计**：
  - 整合骑行和充电数据的年度汇总
  - 左右箭头切换年份查看历史数据
  - 骑行统计：次数、总里程、平均能耗、总电费
  - 充电统计：次数、总度数、总费用
- **月度视图**：
  - 一键切换到月度统计
  - 月份导航（支持跨年）
  - 精确到月份的数据分析
- **视图切换**：日历图标快速切换年度/月度视图

#### 4. 数据可视化分析
- **母线电流效率分析**：气泡图展示母线电流、相线电流、能耗三维关系
- **温度影响分析**：散点图分析电机和控制器温度对能耗的影响
- **续航趋势分析**：折线图追踪理论续航的变化趋势
- **能耗趋势分析**：
  - 双折线对比（实际能耗 vs 移动平均）
  - 最近7天改善分析（与之前7天对比）
  - 按路况智能推荐最优配置
  - 自适应移动平均算法，平滑短期波动
- **充电数据可视化** ⭐ NEW：
  - 周度充电费用图表（最近8周）
  - 月度充电次数图表（最近6个月）
  - 年度充电统计图表（次数、度数、费用混合图表）
- **最省电配置推荐**：自动计算并推荐能耗最优的电流设置

#### 5. 多维度筛选
- **日期范围筛选**：支持今日、近7天、近30天、自定义范围
- **路况标签筛选**：按预设或自定义标签快速筛选记录
- **组合筛选**：日期和标签可同时使用，精准定位数据

#### 4. 记录对比功能
- **智能对比**：选择任意两条记录进行详细对比
- **差值分析**：直观显示电流、能耗、续航、电费的差异
- **优劣标识**：绿色表示更优，红色表示更差，一目了然

#### 5. 成本计算
- **电费统计**：自动计算每次骑行的电费成本
- **周期统计**：今日/本周/本月电费总计
- **自定义电价**：支持设置本地电价（元/kWh）

#### 6. 数据管理
- **Excel导出**：支持导出完整数据到Excel表格
- **JSON备份**：支持导入/导出JSON格式备份
- **智能备份提醒** ⭐ NEW：每新增20条记录自动提醒备份，防止数据丢失
- **本地存储**：所有数据存储在浏览器本地，隐私安全

### 🎨 界面特性

- **渐变视觉设计**：基于能耗等级的动态渐变色彩
- **深色模式支持**：护眼的暗色主题
- **移动端优化**：完美适配手机屏幕
- **流畅动画**：细腻的过渡和交互动画
- **毛玻璃效果**：现代化的半透明设计
- **PWA 支持** ⭐ NEW：
  - 支持安装到桌面，像原生应用一样使用
  - 离线可用，断网也能查看数据
  - 自动缓存资源，二次打开速度极快
  - 自动检查更新并提示

## 🛠️ 技术栈

- **前端框架**：Vue 3 (Composition API)
- **状态管理**：Pinia
- **UI组件库**：Vant 4
- **图表库**：Apache ECharts 5
- **构建工具**：Vite
- **数据导出**：SheetJS (xlsx)

## 🚀 快速开始

### 环境要求

- Node.js 16+
- npm 或 yarn 或 pnpm

### 安装

```bash
# 克隆项目
git clone <repository-url>

# 进入项目目录
cd 电老虎测试

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

### 访问

开发服务器启动后，访问 http://localhost:5173

## 📖 使用指南

### 1. 首次使用 - 设置电池参数

1. 点击底部"设置"标签
2. 设置电池参数：
   - 标称电压（V）：例如 64V
   - 电池容量（Ah）：例如 45Ah
   - 系统会自动计算电池总能量
3. 设置能耗阈值：
   - 优秀阈值：低于此值显示绿色（建议 25 Wh/km）
   - 警告阈值：高于此值显示红色（建议 32 Wh/km）
4. 设置电价（元/kWh）：例如 0.6
5. **设置充电效率** ⭐ NEW：
   - 充电效率（%）：默认 88%（代表12%损耗）
   - 说明：充电时约有12%能量转换损耗
   - 作用：准确计算充电成本（从电网消耗的电量）

### 2. 录入骑行数据

1. 点击首页右上角"+"按钮或底部"录入"标签
2. 设置电流参数：
   - 母线限流：可选择预设值或自定义
   - 相线限流：可选择预设值或自定义
   - **可保存为模板**：点击"保存当前配置为模板"
3. 输入骑行数据：
   - 行驶里程（km）
   - 电量消耗（%）
   - 系统会实时预览能耗和续航
4. 选择路况标签（可选）
5. 记录温度数据（可选）
6. 添加备注（可选）
7. 点击"保存记录"

### 3. 使用模板快速录入

1. 在录入页面，如果已保存模板，会显示模板按钮
2. 点击模板名称，自动填充母线/相线电流
3. 只需输入里程和电量消耗即可

### 4. 查看和筛选记录

#### 日期筛选
- 点击顶部日期范围按钮：全部、今日、近7天、近30天
- 选择"自定义"可以选择任意日期范围

#### 标签筛选
- 点击路况标签进行筛选
- 可与日期范围同时使用

#### 查看统计
- 首页顶部显示今日/本周/本月统计
- 包含：骑行次数、总里程、平均能耗、总电费

### 5. 对比两次骑行

1. 点击左上角"对比"按钮进入对比模式
2. 点击选择第1条记录（显示蓝色边框）
3. 点击选择第2条记录
4. **自动弹出对比窗口**，显示：
   - 两条记录的详细数据
   - 中间显示差值（绿色=更优，红色=更差）
5. 关闭窗口可重新选择对比

### 6. 数据分析

点击底部"图表"标签，查看七种分析图表：

#### 骑行数据图表
**电流效率分析**：
- X轴：母线限流
- Y轴：能耗
- 气泡大小：相线限流
- 颜色：能耗等级（绿/橙/红）
- 找出最佳电流组合

**温度影响分析**：
- 分析电机和控制器温度对能耗的影响
- 蓝色点：电机温度
- 橙色点：控制器温度

**续航趋势**：
- 查看理论续航随时间的变化
- 评估调教效果

**能耗趋势分析**：
- **紫色线（实际能耗）**：每次骑行的真实能耗值
- **绿色线（移动平均）**：平滑的整体趋势线
- **时间轴**：精确到分钟，避免同一天多条记录混淆
- **悬停查看**：鼠标移到图表上显示详细数值
- **改善分析卡片**：
  - 平均能耗：最近7次骑行的平均能耗
  - 趋势标识：↓ X% (改善中) / ↑ X% (需注意) / ≈ X% (稳定)
  - 最佳记录：最近7天内最省电的一次骑行
- **路况智能推荐**：
  - 为每种路况标签推荐最优电流配置
  - 显示该路况下的最低能耗和平均能耗
  - 样本数量越多，推荐越可信（至少3次记录）

#### 充电数据图表 ⭐ NEW
**周度充电费用**：
- 柱状图展示最近8周的充电费用
- 紫色渐变柱状图
- 顶部显示具体金额

**月度充电次数**：
- 柱状图展示最近6个月的充电次数
- 粉橙渐变柱状图
- 顶部显示具体次数

**年度充电统计**：
- 混合图表（柱状图 + 折线图）
- 蓝色柱：充电次数
- 绿色柱：充电度数（kWh）
- 金橙线：充电费用（元）
- 双 Y 轴设计，数据清晰对比

**使用技巧**：
1. **评估调教**：修改电流后，观察绿色趋势线是否下降
2. **发现异常**：紫色线突然飙高，可能遇到特殊路况
3. **长期追踪**：观察电池老化、季节变化对能耗的影响
4. **路况优化**：查看不同路况的推荐配置，创建专属模板
5. **充电分析**：对比不同时期的充电频率和成本

### 7. 充电记录管理 ⭐ NEW

点击底部"充电"标签进入充电管理页面：

#### 录入充电记录
1. 点击右上角"+ 记录"按钮
2. 选择充电日期和时间
3. 输入充电数据：
   - **充电前电量（%）**：充电开始时的 SOC（支持从0%开始）
   - **充电后电量（%）**：充电结束后的 SOC
   - 系统会实时预览 **4项数据**：
     - **充电量**：电量百分比增加量
     - **实际入电量**：电池实际存入的电量（kWh）
     - **充电度数**：从电网消耗的电量（kWh），包含效率损耗
     - **充电费用**：基于充电度数计算的实际电费（元）
   - 💡 预览卡片底部提示：充电度数含 X% 损耗
4. 选择充电地点（可选）：
   - 预设地点：家里、快充站、公司、商场
   - 或输入自定义地点
5. 添加备注（可选）
6. 点击"保存记录"

**充电效率计算说明**：
- **实际入电量** = 充电量 × 电池总能量
- **充电度数** = 实际入电量 ÷ 充电效率（默认88%）
- **充电费用** = 充电度数 × 电价
- 示例：从20%充到80%，电池3.456kWh
  - 充电量：60%
  - 实际入电量：2.074 kWh（电池实际存入）
  - 充电度数：2.357 kWh（从电网消耗，含12%损耗）
  - 充电费用：1.41 元（按0.6元/kWh计算）

#### 查看充电统计
- 页面顶部显示本月和本周充电汇总
- 包含：充电次数、总度数（kWh）、总费用（元）

#### 管理充电记录
- 点击记录可编辑
- 左滑记录可删除
- 每条记录显示：
  - 充电时间和地点
  - SOC 变化（前→后）
  - 充电量、度数、费用
  - 充电徽章（闪电图标 + 充电量）

### 8. 年度/月度统计查看 ⭐ NEW

首页顶部的年度统计卡片提供强大的数据汇总功能：

#### 查看年度数据
1. 默认显示当前年份的统计
2. 点击左箭头查看上一年
3. 点击右箭头查看下一年（不能超过当前年）
4. 统计包含：
   - **骑行数据**：次数、总里程、平均能耗、总电费
   - **充电数据**：次数、总度数、总费用

#### 切换到月度视图
1. 点击左上角的日历图标
2. 视图切换为月度统计
3. 标题显示"YYYY年MM月统计"
4. 使用左右箭头切换月份
5. 月份导航支持跨年（12月→1月会自动切换年份）

#### 使用场景
- **年度总结**：查看全年的骑行和充电总计
- **月度对比**：精确对比不同月份的数据
- **成本分析**：了解不同时期的使用成本
- **趋势观察**：跨年份查看数据变化趋势

### 9. 数据导出

1. 进入"设置"页面
2. 点击"导出 Excel"：导出为表格文件，包含所有字段
3. 点击"导出 JSON 备份"：导出完整备份
4. 点击"导入 JSON 备份"：恢复之前的备份

### 10. 智能备份提醒

#### 自动提醒机制
- 系统会自动跟踪你的记录数量
- 每新增 **20条记录** 时自动弹出备份提醒
- 提醒对话框显示：新增记录数和当前总记录数

#### 如何使用？

**方式1：立即备份**
1. 看到提醒后，点击 **"立即备份"**
2. 系统自动跳转到设置页面并下载 JSON 备份文件
3. 备份计数器自动重置

**方式2：稍后提醒**
1. 点击 **"稍后提醒"**
2. 关闭对话框
3. 下次再新增20条记录时会再次提醒

**主动备份**：
- 在设置页面随时点击"导出 JSON 备份"
- 导出后计数器也会自动重置

#### 为什么需要备份？
- 数据存储在浏览器本地，清除浏览器数据会丢失
- PWA 虽然稳定，但换设备时需要迁移数据
- 定期备份是最安全的数据保护方式

### 11. PWA 安装与离线使用

#### 什么是 PWA？
渐进式 Web 应用（Progressive Web App），可以像原生应用一样安装到设备上，支持离线使用。

#### 如何安装到桌面？

**iOS (iPhone/iPad)**：
1. 使用 Safari 浏览器打开应用
2. 点击底部分享按钮 📤
3. 向下滚动，选择"添加到主屏幕"
4. 点击"添加"，应用图标会出现在主屏幕上

**Android**：
1. 使用 Chrome 浏览器打开应用
2. 浏览器会自动弹出"安装应用"提示
3. 点击"安装"即可
4. 或者点击右上角菜单 ⋮，选择"安装应用"

**桌面端（Windows/Mac/Linux）**：
1. 使用 Chrome 或 Edge 浏览器打开应用
2. 地址栏右侧会出现安装图标 ⊕
3. 点击安装图标，选择"安装"
4. 应用会以独立窗口运行

#### 离线使用
- **首次访问**：应用会自动缓存所有必要资源
- **断网情况**：仍然可以打开应用，查看已有数据，录入新记录
- **数据同步**：所有数据存储在本地，无需网络连接
- **恢复网络**：自动检查更新，有新版本会提示

#### 更新机制
- 应用每小时自动检查一次更新
- 发现新版本时会弹出提示："发现新版本，是否立即更新？"
- 点击确认后自动下载并刷新应用
- 确保始终使用最新功能

## 💡 使用技巧

### 找到最佳电流设置

1. **建立测试矩阵**：
   - 在相同路况下测试多组电流组合
   - 使用统一的标签标记（如"单人通勤"）

2. **分析数据**：
   - 在图表页面查看"电流效率分析"
   - 绿色气泡代表能耗优秀的配置
   - 查看"最省电配置推荐"卡片

3. **对比验证**：
   - 使用对比功能比较不同配置
   - 重点关注能耗和续航的差异

4. **保存常用模板**：
   - 将最优配置保存为"省电模式"
   - 将动力配置保存为"运动模式"
   - 将平衡配置保存为"通勤模式"

### 温度监控

- 定期记录温度数据
- 在温度影响图表中观察异常
- 温度过高时考虑降低电流或增加散热

### 成本控制

- 定期查看电费统计
- 对比不同配置的电费差异
- 评估性能提升的成本代价

## 📝 名词解释

- **母线限流**：电池组总电流限制，影响整体功率
- **相线限流**：电机相线电流限制，影响扭矩输出
- **能耗**：每公里消耗的能量（Wh/km），越低越省电
- **SOC**：State of Charge，电池电量百分比
- **理论续航**：按当前能耗计算的满电续航里程
- **移动平均**：一种数据平滑技术，通过计算一定时间窗口内的平均值来过滤短期波动，显示长期趋势。例如7天移动平均会取最近7次记录的平均能耗，随着新数据加入，窗口向前滑动，持续计算新的平均值
- **充电效率** ⭐ NEW：充电过程中的能量转换效率，默认88%。充电时约有12%能量以热量形式损耗，因此从电网消耗的电量 > 电池实际存入的电量
- **实际入电量** ⭐ NEW：电池实际存入的电量（kWh），等于充电量百分比 × 电池总能量
- **充电度数** ⭐ NEW：从电网消耗的电量（kWh），包含充电损耗，计算公式：实际入电量 ÷ 充电效率。这是计算充电费用的依据，更接近实际电表读数

## 🔒 隐私说明

- 所有数据存储在浏览器本地（localStorage）
- 不会上传到任何服务器
- 清除浏览器数据会丢失记录，建议定期备份
- 支持导出备份到本地文件

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📮 联系方式

如有问题或建议，请通过 Issue 反馈。

---

**注意**：本工具仅供参考，实际续航受多种因素影响（路况、载重、驾驶习惯、温度等）。调整电流设置请在安全范围内进行，确保不超过电池和控制器的额定参数。
